(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function i(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(n){if(n.ep)return;n.ep=!0;const r=i(n);fetch(n.href,r)}})();function F(e){return!e&&e!==0?"N/A":Number(e).toFixed(2)}function a(e,t={},i=[]){const s=document.createElement(e);for(const[n,r]of Object.entries(t))n==="class"?s.className=r:n==="html"?s.innerHTML=r:s.setAttribute(n,r);return Array.isArray(i)&&i.forEach(n=>{typeof n=="string"?s.appendChild(document.createTextNode(n)):n&&s.appendChild(n)}),s}function A(){const e=a("div",{class:"navbar"}),t=a("div",{class:"brand"}),i=a("div",{class:"logo"},["AH"]),s=a("div",{class:"title"},["Anime Hub"]);t.append(i,s);const n=a("div",{class:"nav-actions"}),r=a("button",{class:"pill"},["Home"]),o=a("button",{class:"pill"},["Favoritos"]);return r.addEventListener("click",l=>{l.preventDefault(),L("/")}),o.addEventListener("click",l=>{l.preventDefault(),L("/?view=favs")}),n.append(r,o),e.append(t,n),e}function S({onSearch:e,placeholder:t="Buscar anime, e.j. Naruto"}){const i=a("div",{class:"search"}),s=a("input",{placeholder:t}),n=a("button",{type:"button"},["Buscar"]);return n.addEventListener("click",()=>{e(s.value)}),s.addEventListener("keydown",r=>{r.key==="Enter"&&e(s.value)}),i.append(s,n),i}const m={favorites:new Map,cache:new Map},E=new Set;function H(e){return E.add(e),()=>E.delete(e)}function N(){E.forEach(e=>{try{e(m)}catch{}})}function P(e){!e||!e.mal_id||(m.favorites.set(e.mal_id,e),x(),N())}function O(e){m.favorites.delete(e),x(),N()}function k(e){return m.favorites.has(e)}function j(){return Array.from(m.favorites.values())}function I(e,t){m.cache.set(e,{value:t,ts:Date.now()})}function R(e){const t=m.cache.get(e);return t?t.value:null}function x(){try{const e=Array.from(m.favorites.entries());localStorage.setItem("anime_favs_v1",JSON.stringify(e))}catch{}}function B(){try{const e=localStorage.getItem("anime_favs_v1");if(!e)return;const t=JSON.parse(e);m.favorites=new Map(t)}catch{}}B();const y={subscribe:H,addFavorite:P,removeFavorite:O,isFavorite:k,listFavorites:j,cacheGet:R,cacheSet:I};function $(e){var h,d;const t=a("div",{class:"anime-card"}),i=a("img",{src:((d=(h=e.images)==null?void 0:h.jpg)==null?void 0:d.large_image_url)??"/assets/img/placeholder.png",alt:e.title}),s=a("div",{class:"card-body"}),n=a("h3",{class:"card-title"},[e.title]),r=a("div",{class:"card-meta"},[`${e.type??""}`,`⭐ ${F(e.score)}`]),o=a("div",{class:"row"}),l=a("button",{class:"pill"},["Ver"]),p=a("button",{class:"pill"},[y.isFavorite(e.mal_id)?"Favorito ❤️":"Guardar"]);return l.addEventListener("click",()=>{L(`/anime/${e.mal_id}`)}),p.addEventListener("click",()=>{y.isFavorite(e.mal_id)?(y.removeFavorite(e.mal_id),p.textContent="Guardar"):(y.addFavorite({mal_id:e.mal_id,title:e.title,images:e.images,score:e.score}),p.textContent="Favorito ❤️")}),s.append(n,r,o),o.append(l,p),t.append(i,s),t}function G({page:e=1,last:t=1,onChange:i}){const s=a("div",{class:"pagination"}),n=a("button",{class:"pill"},["◀"]),r=a("button",{class:"pill"},["▶"]);return n.disabled=e<=1,r.disabled=e>=t,n.addEventListener("click",()=>i(Math.max(1,e-1))),r.addEventListener("click",()=>i(Math.min(t,e+1))),s.append(n,a("div",{class:"muted"},[`Página ${e} / ${t}`]),r),s}const v="https://api.jikan.moe/v4",D=15e3;async function g(e,t={}){const i=new AbortController,s=setTimeout(()=>i.abort(),D);try{const n=await fetch(e,{...t,signal:i.signal});if(clearTimeout(s),!n.ok){const r=await n.text().catch(()=>""),o=new Error(`HTTP ${n.status}: ${n.statusText}`);throw o.body=r,o}return n.json()}catch(n){throw n.name==="AbortError"?new Error("Tiempo de espera agotado"):n}}async function U(e,t=1,i=24){const s=`${v}/anime?q=${encodeURIComponent(e)}&page=${t}&limit=${i}`;return g(s)}async function W(e){const t=`${v}/anime/${e}/full`;return g(t)}async function J(e="anime",t=1){const i=`${v}/top/${e}?page=${t}`;return g(i)}async function V(e,t){const i=`${v}/seasons/${e}/${t}`;return g(i)}async function K(){const e=`${v}/seasons/now`;return g(e)}async function Q(e="anime"){const t=`${v}/genres/${e}`;return g(t)}async function q(e){const t=`${v}/anime/${e}/recommendations`;return g(t)}async function z(e){const t=`${v}/anime/${e}/characters`;return g(t)}const w={searchAnime:U,getAnime:W,getTop:J,getSeasonNow:K,getSeason:V,getGenres:Q,getRecommendations:q,getCharacters:z};function X(){const e=a("div",{class:"app-container content"}),t=A(),i=S({onSearch:p}),s=a("div",{class:"grid"}),n=a("div",{});let r=1,o=1,l="";async function p(d){!d||!d.trim()||(l=d.trim(),r=1,await h())}async function h(){var d;s.innerHTML="";for(let c=0;c<6;c++){const u=a("div",{class:"skeleton"},[]);u.style.height="320px",s.appendChild(u)}try{const c=await w.searchAnime(l,r,24);s.innerHTML="";const u=c.data||[];o=((d=c.pagination)==null?void 0:d.last_visible_page)??1,u.length===0?s.appendChild(a("div",{},["No se encontraron resultados."])):u.forEach(f=>s.appendChild($(f))),n.innerHTML="",n.appendChild(G({page:r,last:o,onChange:async f=>{r=f,await h()}}))}catch(c){s.innerHTML="",s.appendChild(a("div",{},["Error al cargar resultados: "+c.message]))}}return async function(){const c=a("div",{},[]);c.append(a("h2",{},["Tendencias"]));const u=a("div",{class:"grid"});try{((await w.getTop("anime",1)).data||[]).slice(0,12).forEach(b=>u.appendChild($(b)))}catch{u.appendChild(a("div",{},["No se pudieron cargar tendencias."]))}c.appendChild(u),e.append(t,i,c,a("h3",{},["Resultados"]),s,n)}(),e}function Y(){const e=a("div",{class:"app-container content"});e.appendChild(A());const t=a("div",{});e.append(t);const s=window.location.pathname.match(/\/anime\/(\d+)/),n=s?s[1]:null;if(!n)return t.appendChild(a("h2",{},["Id de anime inválido"])),e;const r=a("div",{},["Cargando..."]);return t.appendChild(r),async function(){try{const p=(await w.getAnime(n)).data;t.innerHTML="";const h=a("div",{class:"row"},[]),d=a("img",{src:p.images.jpg.large_image_url,alt:p.title});d.style.width="220px",d.style.borderRadius="10px";const c=a("div",{style:"padding-left:12px;max-width:700px;"},[]);c.appendChild(a("h2",{},[p.title])),c.appendChild(a("div",{class:"muted"},[p.title_english||""])),c.appendChild(a("p",{},[p.synopsis??"Sin sinopsis"])),h.append(d,c);const u=a("h3",{},["Recomendaciones"]),f=a("div",{class:"grid"});try{((await w.getRecommendations(n)).data||[]).slice(0,8).forEach(C=>{var _,T;f.appendChild($({mal_id:C.entry.mal_id,title:C.entry.title,images:{jpg:{large_image_url:((T=(_=C.entry.images)==null?void 0:_.jpg)==null?void 0:T.large_image_url)||"/assets/img/placeholder.png"}},score:"N/A"}))})}catch{f.appendChild(a("div",{},["No hay recomendaciones disponibles."]))}t.append(h,u,f)}catch(l){t.innerHTML="",t.appendChild(a("div",{},["Error al cargar anime: "+l.message]))}}(),e}function Z(){const e="/anime-front-web/";let t=window.location.pathname;return t.startsWith(e)&&(t=t.slice(e.length-1)),t||"/"}function M(){const e=document.getElementById("app");e.innerHTML="";const t=Z();if(t==="/"||t===""||t.startsWith("/?")){e.appendChild(X());return}if(/^\/anime\/\d+/.test(t)){e.appendChild(Y());return}const i=document.createElement("div");i.className="content",i.innerHTML=`
    <h2>404 · Página no encontrada</h2>
    <p class="muted">La ruta <code>${t}</code> no existe.</p>
  `,e.appendChild(i)}function L(e){const i="/anime-front-web/"+e.replace(/^\//,"");history.pushState({},"",i),window.dispatchEvent(new Event("popstate"))}document.addEventListener("DOMContentLoaded",()=>{M(),window.addEventListener("popstate",()=>{M()})});
