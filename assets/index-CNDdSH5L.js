(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function s(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(n){if(n.ep)return;n.ep=!0;const r=s(n);fetch(n.href,r)}})();function F(e){return!e&&e!==0?"N/A":Number(e).toFixed(2)}function a(e,t={},s=[]){const i=document.createElement(e);for(const[n,r]of Object.entries(t))n==="class"?i.className=r:n==="html"?i.innerHTML=r:i.setAttribute(n,r);return Array.isArray(s)&&s.forEach(n=>{typeof n=="string"?i.appendChild(document.createTextNode(n)):n&&i.appendChild(n)}),i}function A(){const e=a("div",{class:"navbar"}),t=a("div",{class:"brand"}),s=a("div",{class:"logo"},["AH"]),i=a("div",{class:"title"},["Anime Hub"]);t.append(s,i);const n=a("div",{class:"nav-actions"}),r=a("button",{class:"pill"},["Home"]),o=a("button",{class:"pill"},["Favoritos"]);return r.addEventListener("click",l=>{l.preventDefault(),L("/")}),o.addEventListener("click",l=>{l.preventDefault(),L("/?view=favs")}),n.append(r,o),e.append(t,n),e}function S({onSearch:e,placeholder:t="Buscar anime, e.j. Naruto"}){const s=a("div",{class:"search"}),i=a("input",{placeholder:t}),n=a("button",{type:"button"},["Buscar"]);return n.addEventListener("click",()=>{e(i.value)}),i.addEventListener("keydown",r=>{r.key==="Enter"&&e(i.value)}),s.append(i,n),s}const m={favorites:new Map,cache:new Map},E=new Set;function H(e){return E.add(e),()=>E.delete(e)}function N(){E.forEach(e=>{try{e(m)}catch{}})}function P(e){!e||!e.mal_id||(m.favorites.set(e.mal_id,e),x(),N())}function O(e){m.favorites.delete(e),x(),N()}function k(e){return m.favorites.has(e)}function j(){return Array.from(m.favorites.values())}function I(e,t){m.cache.set(e,{value:t,ts:Date.now()})}function R(e){const t=m.cache.get(e);return t?t.value:null}function x(){try{const e=Array.from(m.favorites.entries());localStorage.setItem("anime_favs_v1",JSON.stringify(e))}catch{}}function B(){try{const e=localStorage.getItem("anime_favs_v1");if(!e)return;const t=JSON.parse(e);m.favorites=new Map(t)}catch{}}B();const y={subscribe:H,addFavorite:P,removeFavorite:O,isFavorite:k,listFavorites:j,cacheGet:R,cacheSet:I};function $(e){var h,d;const t=a("div",{class:"anime-card"}),s=a("img",{src:((d=(h=e.images)==null?void 0:h.jpg)==null?void 0:d.large_image_url)??"/assets/img/placeholder.png",alt:e.title}),i=a("div",{class:"card-body"}),n=a("h3",{class:"card-title"},[e.title]),r=a("div",{class:"card-meta"},[`${e.type??""}`,`⭐ ${F(e.score)}`]),o=a("div",{class:"row"}),l=a("button",{class:"pill"},["Ver"]),u=a("button",{class:"pill"},[y.isFavorite(e.mal_id)?"Favorito ❤️":"Guardar"]);return l.addEventListener("click",()=>{L(`/anime/${e.mal_id}`)}),u.addEventListener("click",()=>{y.isFavorite(e.mal_id)?(y.removeFavorite(e.mal_id),u.textContent="Guardar"):(y.addFavorite({mal_id:e.mal_id,title:e.title,images:e.images,score:e.score}),u.textContent="Favorito ❤️")}),i.append(n,r,o),o.append(l,u),t.append(s,i),t}function G({page:e=1,last:t=1,onChange:s}){const i=a("div",{class:"pagination"}),n=a("button",{class:"pill"},["◀"]),r=a("button",{class:"pill"},["▶"]);return n.disabled=e<=1,r.disabled=e>=t,n.addEventListener("click",()=>s(Math.max(1,e-1))),r.addEventListener("click",()=>s(Math.min(t,e+1))),i.append(n,a("div",{class:"muted"},[`Página ${e} / ${t}`]),r),i}const v="https://api.jikan.moe/v4",D=15e3;async function g(e,t={}){const s=new AbortController,i=setTimeout(()=>s.abort(),D);try{const n=await fetch(e,{...t,signal:s.signal});if(clearTimeout(i),!n.ok){const r=await n.text().catch(()=>""),o=new Error(`HTTP ${n.status}: ${n.statusText}`);throw o.body=r,o}return n.json()}catch(n){throw n.name==="AbortError"?new Error("Tiempo de espera agotado"):n}}async function J(e,t=1,s=24){const i=`${v}/anime?q=${encodeURIComponent(e)}&page=${t}&limit=${s}`;return g(i)}async function U(e){const t=`${v}/anime/${e}/full`;return g(t)}async function V(e="anime",t=1){const s=`${v}/top/${e}?page=${t}`;return g(s)}async function W(e,t){const s=`${v}/seasons/${e}/${t}`;return g(s)}async function K(){const e=`${v}/seasons/now`;return g(e)}async function Q(e="anime"){const t=`${v}/genres/${e}`;return g(t)}async function q(e){const t=`${v}/anime/${e}/recommendations`;return g(t)}async function z(e){const t=`${v}/anime/${e}/characters`;return g(t)}const w={searchAnime:J,getAnime:U,getTop:V,getSeasonNow:K,getSeason:W,getGenres:Q,getRecommendations:q,getCharacters:z};function X(){const e=a("div",{class:"app-container content"}),t=A(),s=S({onSearch:u}),i=a("div",{class:"grid"}),n=a("div",{});let r=1,o=1,l="";async function u(d){!d||!d.trim()||(l=d.trim(),r=1,await h())}async function h(){var d;i.innerHTML="";for(let c=0;c<6;c++){const p=a("div",{class:"skeleton"},[]);p.style.height="320px",i.appendChild(p)}try{const c=await w.searchAnime(l,r,24);i.innerHTML="";const p=c.data||[];o=((d=c.pagination)==null?void 0:d.last_visible_page)??1,p.length===0?i.appendChild(a("div",{},["No se encontraron resultados."])):p.forEach(f=>i.appendChild($(f))),n.innerHTML="",n.appendChild(G({page:r,last:o,onChange:async f=>{r=f,await h()}}))}catch(c){i.innerHTML="",i.appendChild(a("div",{},["Error al cargar resultados: "+c.message]))}}return async function(){const c=a("div",{},[]);c.append(a("h2",{},["Tendencias"]));const p=a("div",{class:"grid"});try{((await w.getTop("anime",1)).data||[]).slice(0,12).forEach(b=>p.appendChild($(b)))}catch{p.appendChild(a("div",{},["No se pudieron cargar tendencias."]))}c.appendChild(p),e.append(t,s,c,a("h3",{},["Resultados"]),i,n)}(),e}function Y(){const e=a("div",{class:"app-container content"});e.appendChild(A());const t=a("div",{});e.append(t);const i=window.location.pathname.match(/\/anime\/(\d+)/),n=i?i[1]:null;if(!n)return t.appendChild(a("h2",{},["Id de anime inválido"])),e;const r=a("div",{},["Cargando..."]);return t.appendChild(r),async function(){try{const u=(await w.getAnime(n)).data;t.innerHTML="";const h=a("div",{class:"row"},[]),d=a("img",{src:u.images.jpg.large_image_url,alt:u.title});d.style.width="220px",d.style.borderRadius="10px";const c=a("div",{style:"padding-left:12px;max-width:700px;"},[]);c.appendChild(a("h2",{},[u.title])),c.appendChild(a("div",{class:"muted"},[u.title_english||""])),c.appendChild(a("p",{},[u.synopsis??"Sin sinopsis"])),h.append(d,c);const p=a("h3",{},["Recomendaciones"]),f=a("div",{class:"grid"});try{((await w.getRecommendations(n)).data||[]).slice(0,8).forEach(C=>{var _,T;f.appendChild($({mal_id:C.entry.mal_id,title:C.entry.title,images:{jpg:{large_image_url:((T=(_=C.entry.images)==null?void 0:_.jpg)==null?void 0:T.large_image_url)||"/assets/img/placeholder.png"}},score:"N/A"}))})}catch{f.appendChild(a("div",{},["No hay recomendaciones disponibles."]))}t.append(h,p,f)}catch(l){t.innerHTML="",t.appendChild(a("div",{},["Error al cargar anime: "+l.message]))}}(),e}function M(e){const t=document.getElementById("app");if(t.innerHTML="",e==="/"||e===""||e.startsWith("/?")){t.appendChild(X());return}if(/^\/anime\/\d+/.test(e)){t.appendChild(Y());return}const s=document.createElement("div");s.className="content",s.innerHTML=`<h2>404 · Página no encontrada</h2><p class="muted">La ruta ${e} no existe.</p>`,t.appendChild(s)}function L(e){history.pushState({},"",e),window.dispatchEvent(new Event("popstate"))}document.addEventListener("DOMContentLoaded",()=>{M(window.location.pathname+window.location.search),window.addEventListener("popstate",()=>{M(window.location.pathname+window.location.search)})});
